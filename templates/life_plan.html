{% load humanize %}
{% load pages_tags mezzanine_tags i18n staticfiles %}

<div class="benefit-content">

{% if num_employers >= EMPLOYER_THRESHOLD %}
    <div class="benefit-header">
        <div class="benefit-details">
            <h4>LIFE INSURANCE BENCHMARKING</h4>
            <h6>INDUSTRIES:<span id='lbl_ft_industries'></span></h6>
            <h6>REGIONS:<span id='lbl_ft_regions'></span></h6>
            <h6>HEADCOUNTS:<span id='lbl_ft_headcounts'></span></h6>
            <h6>OTHER:<span id='lbl_ft_other'></span></h6>
        </div>
        <div class="client-logo">
            <img src="{% static 'img/bnchmrk_logo_stacked.jpg' %}" alt="">
        </div>
    </div>

    <div class="section">
        <div class="section-content">
            <table class="table table-striped table-content">
                <col width="40%">
                <col width="25%">
                <col width="35%">
                <thead>
                    <tr>
                        <th class="row-label">Salary-Based Plans</th>
                        <th>Benchmark</th>
                        <th>Rank</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="row-label">Maximum Benefit</td>
                        <td>${{ mdn_multiple_max|intcomma }}</td>
                        <td>Client</td>
                    </tr>
                    <tr>
                        <td class="row-label">Multiple of Salary</td>
                        <td>{{ mdn_multiple }}</td>
                        <td rowspan="2"></td>
                    </tr>
                    <tr>
                        <td class="row-label">ADD Included</td>
                        <td>{{ prcnt_add }}</td>
                    </tr>
                </tbody>
            </table>  
        </div>
        <div class="section-graph">
            <p class="exhibit-text">Exhibit L6: Maximum Benefit Distribution</p>
            <div id="L-6" class="flot-chart"></div>
        </div>
    </div>

    <div class="section">
        <div class="section-content">
            <table class="table table-striped table-content">
                <col width="40%">
                <col width="25%">
                <col width="35%">
                <thead>
                    <tr>
                        <th class="row-label">Flat Amount Plans</th>
                        <th>Benchmark</th>
                        <th>Rank</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="row-label">Flat Benefit</td>
                        <td>${{ mdn_flat_amount|intcomma }}</td>
                        <td>Client</td>
                    </tr>
                    <tr>
                        <td class="row-label">ADD Included</td>
                        <td>{{ prcnt_add }}</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="section-graph">
            <p class="exhibit-text">Exhibit L5: Flat Benefit Distribution</p>
            <div id="L-5" class="flot-chart"></div>
        </div>
    </div>

    <div class="section">
        <div class="section-content">
            <table class="table table-striped table-content">
                <col width="50%">
                <col width="50%">
                <thead>
                    <th class="row-label">Cost Share</th>
                    <th>Employers</th>
                </thead>
                <tbody>
                    <tr>
                        <td class="row-label">100% Employer Paid Only</td>
                        <td>{{ prcnt_paid }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">Employee Cost Share Only</td>
                        <td>{{ prcnt_share }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">Core & Buy Up Plans</td>
                        <td>{{ prcnt_paid_share }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">Not Reported</td>
                        <td>{{ prcnt_non_reported }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">Not Offered</td>
                        <td>{{ prcnt_type_plan_none }}%</td>
                    </tr>
                </tbody>
            </table>  
        </div>
        <div class="section-graph">
            <p class="exhibit-text">Exhibit L2-L4: Cost Share</p>
            <div class="easy-pie L-2" data-percent="{{ prcnt_paid }}">
                <div class="percent">{{ prcnt_paid }}</div>
                <div class="pie-title">100% Employer Paid Only</div>
            </div>
            <div class="easy-pie L-3" data-percent="{{ prcnt_share }}">
                <div class="percent">{{ prcnt_share }}</div>
                <div class="pie-title">Employee Cost Share Only</div>
            </div>
            <div class="easy-pie L-4" data-percent="{{ prcnt_paid_share }}">
                <div class="percent">{{ prcnt_paid_share }}</div>
                <div class="pie-title">Core / Buy Up</div>
            </div>
        </div>
    </div>


    <div class="section">
        <div class="section-content">
            <table class="table table-striped table-content">
                <col width="50%">
                <col width="50%">
                <thead>
                    <tr>
                        <th class="row-label">Number of Plans</th>
                        <th>Employers</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="row-label">Not Offered</td>
                        <td>{{ prcnt_plan0 }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">1 Plan</td>
                        <td>{{ prcnt_plan1 }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">2 Plans</td>
                        <td>{{ prcnt_plan2 }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">3 or More Plans</td>
                        <td>{{ prcnt_plan3_or_more }}%</td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-striped table-content">
                <col width="50%">
                <col width="50%">
                <thead>
                    <tr>
                        <th class="row-label">Plan Types</th>
                        <th>Employers</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="row-label">Salary-Based Plans Only</td>
                        <td>{{ prcnt_type_plan_mul }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">Flat Plans Only</td>
                        <td>{{ prcnt_type_plan_flat }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">Both Multiple & Flat Plans</td>
                        <td>{{ prcnt_type_plan_mul_flat }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">Not Reported</td>
                        <td>{{ prcnt_type_non_reported }}%</td>
                    </tr>
                    <tr>
                        <td class="row-label">Not Offered</td>
                        <td>{{ prcnt_type_plan_none }}%</td>
                    </tr>
                </tbody>
            </table>  
        </div>
        <div class="section-graph">
            <p class="exhibit-text">Exhibit L1: Number of Plans Offered</p>
            <div id="L-1" class="flot-chart-pie"></div>
            <div class="flc-donut hidden-xs"></div>
        </div>
    </div>

    {% else %}
    <div class="benefit-error">
        <p class="threshold-error">{{ EMPLOYER_THRESHOLD_MESSAGE }}</p>
    </div>
    {% endif %}

</div>

<script type="text/javascript">

var l1_data, l5_data, l6_data;

{% if num_employers >= EMPLOYER_THRESHOLD %}
    l1_data = [
        {data: {{ prcnt_plan0 }}, color: '#F44336', label: 'Not Offered'},
        {data: {{ prcnt_plan1 }}, color: '#03A9F4', label: '1 Plan'},
        {data: {{ prcnt_plan2 }}, color: '#8BC34A', label: '2 Plans'},
        {data: {{ prcnt_plan3_or_more }}, color: '#FFEB3B', label: '3+ Plans'},
    ];

    var flat_array = {{ flat_array }};
    l5_data = [{
        data : flat_array,
        bars : {
            show : true,
            barWidth : 0.75,
            order : 1,
            lineWidth: 0,
            fillColor: '#8BC34A',
            align: "right"
        }
    }];    

    var d0 = [{{ mn_flat_amount }}, {{ sdv_flat_amount }}];
    var d1 = [];

    for (var i = 0; i < 12; i += 1)
        d1.push([flat_array[i][0], NormalDensityZx(i * 10000,d0[0],d0[1]) * 4000000]);

    l5_data.push({
        data : d1,
        color: "#0062FF",
    });

    var quintile_array = {{ quintile_array }};
    var qa_points = $.map(quintile_array, function(i){if (i[0]%20==0) return [i];});
    l6_data = [
        {
            data: qa_points,
            points: { show: true, radius: 5 },
            lines: { show: false, fill: 0.98 },
            color: '#f1dd2c'
        }
    ];

    var section = [];
    for( var i = 0; i < quintile_array.length; i++ ) {
        section.push(quintile_array[i]);
        if ( i > 0 && quintile_array[i][0] % 20 == 0) {
            l6_data.push({
                data : section,
                points: { show: false },
                lines: { show: true, fill: 0.98 },
                color: colors[quintile_array[i][0] / 20 - 1]
            });
            section = [quintile_array[i]];
        }
    }    

{% endif %}
</script>